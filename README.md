# Salim Footwear Chatbot

A WhatsApp chatbot for Salim Footwear, built with Python (Flask) and the WhatsApp Cloud API. This bot handles incoming messages, displays product categories, and provides redirect links to the product catalog.

## Prerequisites

*   Python 3.8 or higher
*   PostgreSQL Database
*   A Meta Developer Account and a WhatsApp Business App
*   `ngrok` (for local development/webhook testing)

## Installation

1.  **Clone the repository:**
    ```bash
    git clone <repository_url>
    cd salim-chatbot
    ```

2.  **Create and activate a virtual environment:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate  # On Windows use `venv\Scripts\activate`
    ```

3.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

## Database Setup 
IMPORTANT : Ignore below instruction for Salim chatbot. 

1.  Ensure you have a PostgreSQL database running.
2.  Run the provided SQL script to create the necessary tables:
    ```bash
    psql -h <host> -U <username> -d <database_name> -f pg-script.sql
    ```
    *(Or execute the contents of `pg-script.sql` using your preferred database tool).*

## Configuration

Create a `.env` file in the root directory and add the following environment variables:

### WhatsApp API Configuration
```env
# Meta Cloud API URL (replace <phone_number_id>)
WHATSAPP_PUSH_URL=https://graph.facebook.com/v24.0/<phone_number_id>/messages

# Your WhatsApp Bot Phone Number (e.g., +91...)
WHATSAPP_BOT_NUMBER=+91XXXXXXXXXX

# Verification token you set in the Meta App Dashboard
WEBHOOK_VERIFY_TOKEN=your_verify_token
```

### Application URLs
```env
# API to fetch categories
CATEGORY_API_URL=https://saleem-footwear-api.vercel.app/api/v1/search/category

# Base URL for product redirection
PRODUCTS_REDIRECT_BASE_URL=https://saleem-footwear.vercel.app/shop
```

### Database Configuration (PostgreSQL)
```env
TARGET_HOST=localhost
TARGET_USER=your_db_user
TARGET_PASSWORD=your_db_password
TARGET_DATABASE=your_db_name
TARGET_PORT=5432
TARGET_SCHEMA=public
```

### Authentication Service (if applicable)
```env
LOGIN_URL=https://api.example.com/oauth/token
LOGIN_USERNAME=client_username
LOGIN_PASSWORD=client_password
```

## Running the Application

1.  **Start the Flask server:**
    ```bash
    python main.py
    ```
    The application will run on `http://0.0.0.0:8080` by default.

2.  **Expose the server (Local Development):**
    If you are testing the webhook locally, use `ngrok` to expose port 8080:
    ```bash
    ngrok http 8080
    ```
    Copy the HTTPS URL generated by ngrok (e.g., `https://xxxx-xx-xx-xx-xx.ngrok-free.app`).

## Webhook Setup

1.  Go to the [Meta Developers Portal](https://developers.facebook.com/).
2.  Navigate to your App > WhatsApp > Configuration.
3.  Click **Edit** button in the Webhook section.
4.  **Callback URL**: Paste your ngrok URL (or deployed domain) followed by `/webhook/inbound-message`.
    *   Example: `https://your-domain.com/webhook/inbound-message`
5.  **Verify Token**: Enter the value you set for `WEBHOOK_VERIFY_TOKEN` in your `.env`.
6.  Click **Verify and Save**.

## Project Structure

*   `main.py`: Entry point of the application.
*   `routers/`: Contains Flask blueprints and route definitions.
    *   `whatsapp.py`: Handles WhatsApp webhook verification and incoming messages.
*   `routers_helper/`: Helper logic for processing requests.
    *   `salim_helper.py`: Core logic for constructing payloads and interacting with external APIs.
*   `utils/`: Utility modules.
    *   `database.py`: Database connection and helper class.
    *   `access_token.py`: Manages authentication tokens.